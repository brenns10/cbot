<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Administering CBot &#8212; cbot 0.12.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=19e90285"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Development" href="dev.html" />
    <link rel="prev" title="Users" href="User.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="administering-cbot">
<h1>Administering CBot<a class="headerlink" href="#administering-cbot" title="Permalink to this heading">¶</a></h1>
<section id="installing-distribution-packages">
<h2>Installing (Distribution Packages)<a class="headerlink" href="#installing-distribution-packages" title="Permalink to this heading">¶</a></h2>
<p>CBot has source releases on <a class="reference external" href="https://github.com/brenns10/cbot">Github</a> as well
as binary package releases for Alpine Linux. You can install the Alpine packages
with <code class="docutils literal notranslate"><span class="pre">apk</span> <span class="pre">add</span> <span class="pre">--allow-untrusted</span> <span class="pre">&lt;file&gt;</span></code>. For other Linux distributions, you’ll
need to install from source.</p>
</section>
<section id="installing-docker">
<h2>Installing (Docker)<a class="headerlink" href="#installing-docker" title="Permalink to this heading">¶</a></h2>
<p>CBot also has Docker images published on <a class="reference external" href="https://hub.docker.com/r/brenns10/cbot">Docker Hub</a>. Since version v0.8.0, these Docker
images no longer contain Signald bundled. If you want to run CBot with Signal,
you’ll need to setup Signald yourself, likely via their Docker image.
Docker-Compose is great for this.</p>
</section>
<section id="installing-from-source">
<h2>Installing (From Source)<a class="headerlink" href="#installing-from-source" title="Permalink to this heading">¶</a></h2>
<section id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h3>
<p>First, you’ll need to unpack your source release (or checkout a git revision of
interest). Next, setup your dependencies. The following are dependencies of
CBot.</p>
<ul class="simple">
<li><p>meson: this is the build system for CBot, it is required (usually a package
named <code class="docutils literal notranslate"><span class="pre">meson</span></code>)</p></li>
<li><p>A C compiler (gcc or clang)</p></li>
<li><p>libconfig: This is used to parse the configuration file. It is required.</p></li>
<li><p>libcurl: For HTTP queries to APIs. It is required.</p></li>
<li><p>libmicrohttpd: For HTTP server. It is required</p></li>
<li><p>libircclient: This is for IRC support. It is required, but we can use a
“vendored” version if your OS doesn’t package it.</p></li>
<li><p>sqlite3: Used for maintaining state. It is required, but we can use a vendored
version as necessary.</p></li>
<li><p>Several libraries from <a class="reference external" href="https://sr.ht/~brenns10/sc-libs/">sc-libs</a>, these
can all be setup by the build system, as they have no OS packaging.</p></li>
</ul>
<p>Here are some commands to get setup for various distributions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ubuntu</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>meson<span class="w"> </span>gcc<span class="w"> </span>libconfig-dev<span class="w"> </span>libcurl4-openssl-dev<span class="w"> </span>libsqlite3-dev<span class="w"> </span>libmicrohttpd-dev

<span class="c1"># Arch</span>
sudo<span class="w"> </span>pacman<span class="w"> </span>-Sy<span class="w"> </span>meson<span class="w"> </span>gcc<span class="w"> </span>libconfig<span class="w"> </span>curl<span class="w"> </span>sqlite<span class="w"> </span>libmicrohttpd
</pre></div>
</div>
</section>
<section id="building">
<h3>Building<a class="headerlink" href="#building" title="Permalink to this heading">¶</a></h3>
<p>Once you have setup the dependencies, you’ll need to build the project:</p>
<p>This project uses the Meson build system. The following commands will build the
project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># creates a build directory named &quot;build&quot;</span>
meson<span class="w"> </span>build
<span class="c1"># change to &quot;build&quot; and compile everything</span>
ninja<span class="w"> </span>-C<span class="w"> </span>build
</pre></div>
</div>
<p>During the <code class="docutils literal notranslate"><span class="pre">meson</span> <span class="pre">build</span></code> step, the build system will download any dependencies
that it cannot find installed on your system, including all of the sc-libs
dependencies.</p>
<p>During <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">-C</span> <span class="pre">build</span></code>, the actual program compilation happens. It should be
snappy.</p>
</section>
<section id="initial-run">
<h3>Initial Run<a class="headerlink" href="#initial-run" title="Permalink to this heading">¶</a></h3>
<p>To test your built program, you can use <code class="docutils literal notranslate"><span class="pre">sample.cfg</span></code>, which sets up some
plugins in the CLI. Simply run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>build/cbot<span class="w"> </span>sample.cfg
</pre></div>
</div>
</section>
</section>
<section id="configuring">
<h2>Configuring<a class="headerlink" href="#configuring" title="Permalink to this heading">¶</a></h2>
<p>A sample configuration file is bundled as <code class="docutils literal notranslate"><span class="pre">sample.cfg</span></code>. This should be used as
the basis for your configuration. However, there are some very important things
which ought to be documented.</p>
<section id="choosing-configuring-backend">
<h3>Choosing &amp; Configuring Backend<a class="headerlink" href="#choosing-configuring-backend" title="Permalink to this heading">¶</a></h3>
<p>In the <code class="docutils literal notranslate"><span class="pre">cbot</span></code> configuration object, you should find an option <code class="docutils literal notranslate"><span class="pre">backend</span></code>.
This is required, and you can choose between:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;irc&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;signal&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;cli&quot;</span></code></p></li>
</ul>
<p>Whichever backend you choose, you must also have a corresponding top-level
configuration object with the same name. This object provides necessary config
for the backend.</p>
<p>For the irc backend, you need to configure:</p>
<ul class="simple">
<li><p>host: string hostname (use “#” prefix for SSL)</p></li>
<li><p>port: integer port</p></li>
<li><p>password: string password</p></li>
</ul>
<p>For the signal backend, you must run an instance of <a class="reference external" href="https://signald.org/">Signald</a>. The following configuration is avaialable:</p>
<ul class="simple">
<li><p>phone: phone number of bot account</p></li>
<li><p>signald_socket: filename to connect to Signald</p></li>
<li><p>auth: authorized phone number of privileged account</p></li>
<li><p>ignore_dm: should the bot ignore DMs?</p></li>
</ul>
</section>
<section id="configuring-cbot">
<h3>Configuring CBot<a class="headerlink" href="#configuring-cbot" title="Permalink to this heading">¶</a></h3>
<p>Beyond the backend configuration, the <code class="docutils literal notranslate"><span class="pre">plugins</span></code> top-level configuration option
specifies each plugin which is loaded. Each plugin named in this mapping will be
loaded. The plugin can be mapped to an empty config dict for plugins with no
options, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">:</span> <span class="p">{};</span>
</pre></div>
</div>
<p>If the plugin requires configuration, it can be provided in these objects.
Please see <code class="docutils literal notranslate"><span class="pre">sample.cfg</span></code> for examples of each plugin’s configuration.</p>
</section>
</section>
<section id="plugins">
<h2>Plugins<a class="headerlink" href="#plugins" title="Permalink to this heading">¶</a></h2>
<p>This section documents the administration side of some plugins, in case they
need a bit more explanation.</p>
<section id="trivia">
<h3>Trivia<a class="headerlink" href="#trivia" title="Permalink to this heading">¶</a></h3>
<p>The trivia plugin is a powerful weekly reminder system for the group chat.
Basically, every week at a given time, a message gets sent announcing the trivia
night and requesting RSVP. Then, at the RSVP deadline, a message gets sent to
the trivia host to RSVP a table.</p>
<p>In order to RSVP, users react with any emoji, except for a few sad face emoji
choices. If they react with a numeric emoji, that indicates bringing a guest.</p>
<p>While it’s definitely nice to RSVP and reserve a table, the main benefit is
actually for reminding everybody that it’s trivia day, and letting everybody see
who else will be joining, without needing to fill the chat with lots of
notifications.</p>
<p>The RSVP message can be sent to trivia host in one of two ways:</p>
<ol class="arabic simple">
<li><p>Email</p></li>
<li><p>SMS</p></li>
</ol>
<p>Strangely, signal is not an option here (but it could be easily added, if it
were needed). The email option was the original, but the SMS option can be
configured with “ntfy.sh” and the android app Tasker to automate the SMS
sending.</p>
<p>Configurations:</p>
<ul class="simple">
<li><p>channel: set the channel where trivia is organized (required)</p></li>
<li><p>sendmail_command: set the command to run to send email (or SMS). This command
is executed via <code class="docutils literal notranslate"><span class="pre">popen()</span></code>, which means that it is passed to the system
shell, and the message text is written into the command via stdin.</p>
<ul>
<li><p>A configuration like <code class="docutils literal notranslate"><span class="pre">msmtp</span> <span class="pre">-t</span> <span class="pre">recipient&#64;example.com</span></code> works well for Email
based sending.</p></li>
<li><p>A configuration like <code class="docutils literal notranslate"><span class="pre">perl</span> <span class="pre">-pe</span> <span class="pre">'s/\n/\r\n'</span> <span class="pre">-</span> <span class="pre">|</span> <span class="pre">curl</span> <span class="pre">--data-binary</span> <span class="pre">&#64;-</span> <span class="pre">https://ntfy.sh/TOPIC</span></code>
works for SMS. You’ll then need to configure ntfy.sh and the Android Tasker
app as seen <a class="reference external" href="https://docs.ntfy.sh/subscribe/phone/#automation-apps">here</a>.</p></li>
</ul>
</li>
<li><p>email_format: set this to false when you’re using SMS, true for email (default
true)</p></li>
<li><p>init_hour, init_minute: the start time for trivia</p></li>
<li><p>send_hour, send_miniute: the rsvp time for trivia</p></li>
<li><p>trivia_weekday: day of week (0 - Sunday, 1 - Monday, etc…)</p></li>
<li><p>from_name: string name of sender</p></li>
<li><p>to_name: string name of recipient</p></li>
<li><p>from: sender email address (required when email_format is set)</p></li>
<li><p>to: recipient email address (required when email_format is set)</p></li>
</ul>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">cbot</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="User.html">Users</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Administering CBot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-distribution-packages">Installing (Distribution Packages)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-docker">Installing (Docker)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-from-source">Installing (From Source)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring">Configuring</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plugins">Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Development</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="User.html" title="previous chapter">Users</a></li>
      <li>Next: <a href="dev.html" title="next chapter">Development</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021 Stephen Brennan.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/admin.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>